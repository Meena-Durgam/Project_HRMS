{% extends 'base.html' %}
{% load static %}
{% block title %}Qubits HRMS | Timesheet {% endblock %}

{% load widget_tweaks %}

{% block content %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-12 col-md">
            <h3 class="page-title">Timesheet</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                <li class="breadcrumb-item active">Timesheet</li>
            </ul>
        </div>
        <!-- ✅ Fix this button -->
        
    </div>
</div>

<!-- Filter Form -->
{% if messages %}
  <div class="messages mt-2">
    {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-danger
                       {% elif message.tags == 'success' %}alert-success
                       {% elif message.tags == 'warning' %}alert-warning
                       {% elif message.tags == 'info' %}alert-info
                       {% else %}alert-secondary{% endif %} alert-dismissible fade show" role="alert">
        {{ message }}
<button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- Timesheet Table -->
<div class="table-responsive">
   <table class="table table-striped custom-table mb-0 datatable">
        <thead>
            <tr>
                <th>Employee</th>
                <th>Date</th>
                <th>Project</th>
                <th>Clock In</th>
                <th>Clock Out</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for t in timesheets %}
            <tr>
                <td>
                    {% if t.employee.user %}
                        {{ t.employee.user.get_full_name|default:t.employee.user.username }}
                    {% else %}
                        <span class="text-muted">Unknown</span>
                    {% endif %}
                </td>

                <td>{{ t.date }}</td>
                <td>{{ t.project }}</td>
                <td>{{ t.clock_in|time:"H:i A"|default:"—" }}</td>
<td>{{ t.clock_out|time:"H:i A"|default:"—" }}</td>

                <td >
    <div class="dropdown action-label">
        <a class="btn btn-white btn-sm btn-rounded dropdown-toggle" href="#" data-toggle="dropdown">
            {% if t.status == 'Approved' %}
                <i class="fa fa-dot-circle-o text-success"></i> Approved
            {% elif t.status == 'Rejected' %}
                <i class="fa fa-dot-circle-o text-danger"></i> Rejected
            {% else %}
                <i class="fa fa-dot-circle-o text-warning"></i> Pending
            {% endif %}
        </a>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{% url 'update_timesheet_status' t.pk 'Approved' %}">
                <i class="fa fa-dot-circle-o text-success"></i> Approve
            </a>
            <a class="dropdown-item" href="{% url 'update_timesheet_status' t.pk 'Rejected' %}">
                <i class="fa fa-dot-circle-o text-danger"></i> Reject
            </a>
        </div>
        
    </div>
</td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center text-muted">No timesheets found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
