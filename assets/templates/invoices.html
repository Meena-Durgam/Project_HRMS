{% extends "base.html" %}
{% load static %}
{% block title %}Qubits HRMS | Invoices {% endblock %}

{% block content %}
<style>
  .filter-row .form-control,
  .filter-row .select,
  .filter-row button {
    height: 51px;
    padding: 10px 15px;
    font-size: 14px;
    border-radius: 5px;
  }

  .filter-row button {
    width: 100%;
  }

  .select-arrow-spacing {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;

  background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='30' viewBox='0 0 24 24' width='30' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;

  /* ðŸ‘‡ Arrow spacing from the right */
  background-position: right 14px center;

  /* ðŸ‘‡ Add right padding so text doesn't collide with the arrow */
  padding-right: 38px;

  background-size: 24px;}
</style>

    <!-- Page Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h3 class="page-title">Invoices</h3>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                    <li class="breadcrumb-item active">Invoices</li>
                </ul>
            </div>
{% if request.user.role == "company_owner" or request.user.employee_account.department.name == "Human Resources" %}
            <div class="col-auto float-right ml-auto">
                <a href="{% url 'invoice_create' %}" class="btn add-btn"><i class="fa fa-plus"></i> Create Invoice</a>
            </div>
            {% endif %}
        </div>
    </div>
    <!-- /Page Header -->
{% if messages %}
  <div class="messages mt-2">
    {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-danger
                       {% elif message.tags == 'success' %}alert-success
                       {% elif message.tags == 'warning' %}alert-warning
                       {% elif message.tags == 'info' %}alert-info
                       {% else %}alert-secondary{% endif %} alert-dismissible fade show" role="alert">
        {{ message }}
<button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
    {% endfor %}
  </div>
{% endif %}

    <!-- Search Filter -->
    <form method="get" action="{% url 'estimate_list' %}">
  <div class="row filter-row align-items-center">  <!-- Added align-items-center -->

    <!-- From Date -->
    <div class="col-sm-6 col-md-3">
      <div class="form-group">
        <label for="from_date" class="form-label">Start Date</label>
        <input class="form-control text-uppercase py-3"
               type="date"
               id="from_date"
               name="from_date"
               placeholder="MM/DD/YYYY"
               value="{{ request.GET.from_date }}"
               required
               pattern="\d{2}/\d{2}/\d{4}">
      </div>
    </div>

    <!-- To Date -->
    <div class="col-sm-6 col-md-3">
      <div class="form-group">
        <label for="to_date" class="form-label">End Date</label>
        <input class="form-control text-uppercase py-3"
               type="date"
               id="to_date"
               name="to_date"
               placeholder="MM/DD/YYYY"
               value="{{ request.GET.to_date }}"
               required
               pattern="\d{2}/\d{2}/\d{4}">
      </div>
    </div>

    <!-- Status Dropdown -->
    <div class="col-sm-6 col-md-3">
      <div class="form-group">
        <label for="status" class="form-label">Status</label>
        <select id="status" name="status" class="form-control custom-select-padding select-arrow-spacing py-3">
          <option value="">Select Status</option>
          <option value="Draft" {% if request.GET.status == "Draft" %}selected{% endif %}>Draft</option>
          <option value="Sent" {% if request.GET.status == "Sent" %}selected{% endif %}>Sent</option>
          <option value="Paid" {% if request.GET.status == "Paid" %}selected{% endif %}>Paid</option>
          <option value="Overdue" {% if request.GET.status == "Overdue" %}selected{% endif %}>Overdue</option>
        </select>
      </div>
    </div>

    <!-- Submit Button -->
   <div class="col-12 col-sm-6 col-md-3 d-flex align-items-end">
   <button type="submit" class="btn btn-primary" style="width: 100%; height: 40px;">Search</button>

  </div>
  </div>
</form>

    <div class="row">
  <div class="col-md-12">
    <div class="table-responsive">
      <table class="table table-striped custom-table mb-0">
        <thead>
          <tr>
            <th>Invoice Number</th>
            <th>Client</th>
            <th>Project</th>
            <th>Invoice Date</th>
            <th>Due Date</th>
            <th>Tax (%)</th>
            <th>Tax Amount</th>
            <th>Total</th>
            <th>Status</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% if invoices %}
            {% for invoice in invoices %}
            <tr>
              <td><a href="{% url 'invoice_detail' invoice.id %}">{{ invoice.invoice_number }}</a></td>
              <td>{{ invoice.client.client_name }}</td>
              <td>{{ invoice.project.name }}</td>
              <td>{{ invoice.invoice_date }}</td>
              <td>{{ invoice.due_date }}</td>
              <td>{{ invoice.tax }}</td>
              <td>â‚¹{{ invoice.tax_amount }}</td>
              <td>â‚¹{{ invoice.grand_total }}</td>
              <td>
                {% if invoice.status == 'Paid' %}
                  <span class="badge bg-inverse-success">Paid</span>
                {% elif invoice.status == 'Overdue' %}
                  <span class="badge bg-inverse-danger">Overdue</span>
                {% elif invoice.status == 'Draft' %}
                  <span class="badge bg-inverse-warning">Draft</span>
                {% elif invoice.status == 'Sent' %}
                  <span class="badge bg-inverse-info">Sent</span>
                {% else %}
                  <span class="badge bg-inverse-secondary">{{ invoice.status }}</span>
                {% endif %}
              </td>
              <td class="text-center">
                <div class="dropdown dropdown-action">
                  <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <i class="material-icons">more_vert</i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="{% url 'invoice_detail' invoice.id %}">
                      <i class="fa fa-eye m-r-5"></i> View
                    </a>
                    <a class="dropdown-item" href="{% url 'invoice_update' invoice.id %}">
                      <i class="fa fa-pencil m-r-5"></i> Edit
                    </a>
                    <a class="dropdown-item text-danger" href="#" data-toggle="modal" data-target="#delete_invoice_{{ invoice.id }}">
                      <i class="fa fa-trash-o m-r-5"></i> Delete
                    </a>
                  </div>
                </div>

                <!-- Delete Modal -->
                <div class="modal custom-modal fade" id="delete_invoice_{{ invoice.id }}" role="dialog">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-body">
                        <div class="form-header">
                          <h3>Delete Invoice</h3>
                          <p>Are you sure you want to delete this invoice?</p>
                        </div>
                        <div class="modal-btn delete-action">
                          <div class="row">
                            <div class="col-6">
                              <a href="{% url 'invoice_delete' invoice.id %}" class="btn btn-primary continue-btn">Delete</a>
                            </div>
                            <div class="col-6">
                              <a href="javascript:void(0);" data-dismiss="modal" class="btn btn-primary cancel-btn">Cancel</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /Delete Modal -->
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="10" class="text-center text-muted py-4">No invoices found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

    </div>

<!-- JS & Datepicker -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {
        $('.datetimepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        });
    });
</script>
{% endblock %}
