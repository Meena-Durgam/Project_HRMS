{% extends 'base.html' %}
{% load static %}

{% block title %}Subscription Plans{% endblock %}

{% block content %}

  <h3 class="mb-4">Choose a Subscription Plan</h3>

  {% if current_subscription %}
    <div class="alert alert-success">
      You are currently subscribed to: <strong>{{ current_subscription.package.name }}</strong>
      <button type="button" class="close" data-bs-dismiss="alert">&times;</button>
    </div>
  {% endif %}

  <ul class="nav nav-pills justify-content-center mb-4" id="planTypeTabs">
  <li class="nav-item">
    <a class="nav-link active" href="#" data-plan-type="Monthly">Monthly</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#" data-plan-type="Yearly">Yearly</a>
  </li>
</ul>


  <div class="row" id="monthlyPlans">
    {% for plan in monthly_plans %}
    <div class="col-md-3">
      <div class="card plan-card h-100 shadow-sm">
        <div class="card-body">
          <h5>{{ plan.name }}</h5>
          <h4>${{ plan.amount }} / <small>{{ plan.plan_type }}</small></h4>
          <hr>
          <p class="fw-bold">Includes:</p>
          <ul class="list-unstyled">
            <li>{{ plan.number_of_users }} Users</li>
            <li>{{ plan.number_of_projects }} Projects</li>
            <li>{{ plan.storage_space }} GB Storage</li>
            <li>{{ plan.voice_video|yesno:"Voice/Video Chat Included,Voice/Video Chat Not Available" }}</li>
            <li>{{ plan.crm|yesno:"CRM Included,CRM Not Available" }}</li>
          </ul>
        </div>
        <div class="card-footer bg-transparent border-top-0">
          <a href="{% url 'subscribe_to_package' plan.id %}" class="btn btn-primary w-100">Subscribe Now</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="row d-none" id="yearlyPlans">
    {% for plan in yearly_plans %}
    <div class="col-md-3">
      <div class="card plan-card h-100 shadow-sm">
        <div class="card-body">
          <h5>{{ plan.name }}</h5>
          <h4>${{ plan.amount }} / <small>{{ plan.plan_type }}</small></h4>
          <hr>
          <p class="fw-bold">Includes:</p>
          <ul class="list-unstyled">
            <li>{{ plan.number_of_users }} Users</li>
            <li>{{ plan.number_of_projects }} Projects</li>
            <li>{{ plan.storage_space }} GB Storage</li>
            <li>{{ plan.voice_video|yesno:"Voice/Video Chat Included,Voice/Video Chat Not Available" }}</li>
            <li>{{ plan.crm|yesno:"CRM Included,CRM Not Available" }}</li>
          </ul>
        </div>
        <div class="card-footer bg-transparent border-top-0">
          <a href="{% url 'subscribe_to_package' plan.id %}" class="btn btn-primary w-100">Subscribe Now</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
<h4 class="mt-5 mb-3">Your Subscriptions</h4>

<div class="table-responsive">
  <table class="table table-striped custom-table datatable">
    <thead class="table-light">
      <tr>
        <th>Plan Name</th>
        <th>Plan Type</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for sub in subscriptions %}
      <tr>
        <td>{{ sub.package.name }}</td>
        <td>{{ sub.package.plan_type }}</td>
        <td>{{ sub.subscribed_on|date:"d M Y" }}</td>
        <td>{{ sub.end_date|date:"d M Y" }}</td>
        <td>â‚¹ {{ sub.package.amount }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">No subscriptions found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<script>
  const monthlyTab = document.querySelector('[data-plan-type="Monthly"]');
  const yearlyTab = document.querySelector('[data-plan-type="Yearly"]');
  const monthlyPlans = document.getElementById('monthlyPlans');
  const yearlyPlans = document.getElementById('yearlyPlans');

  monthlyTab.addEventListener('click', function(e) {
    e.preventDefault();
    this.classList.add('active');
    yearlyTab.classList.remove('active');
    monthlyPlans.classList.remove('d-none');
    yearlyPlans.classList.add('d-none');
  });

  yearlyTab.addEventListener('click', function(e) {
    e.preventDefault();
    this.classList.add('active');
    monthlyTab.classList.remove('active');
    yearlyPlans.classList.remove('d-none');
    monthlyPlans.classList.add('d-none');
  });
</script>

<style>
  .plan-card {
    border-radius: 12px;
    border: 1px solid #e3e3e3;
    transition: 0.3s;
  }

  .plan-card:hover {
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  .nav-pills .nav-link.active {
    background-color: #4b7bec;
    font-weight: 600;
  }
</style>
{% endblock %}
